import{ac as d,ad as l,ae as c,o as u,s as b,af as g,j as m,ag as p,e as f,l as a,ah as k,ai as y,aj as S,ak as n,al as o,am as v,an as h}from"./vidstack-1H0xyD-V-D-amjwjB.js";class T{constructor(t){this.eb=t}Wa(){d(this.td)&&this._h()}Xa(){l(this.td)&&window.cancelAnimationFrame(this.td),this.td=void 0}_h(){this.td=window.requestAnimationFrame(()=>{d(this.td)||(this.eb(),this._h())})}}class w{constructor(t,i){this.Da=p(),this.Ug=!1,this.Wg=!1,this.Xg=!1,this.Vg=new T(this.$g.bind(this)),this._g=void 0,this.rh=void 0,this.Dc=t,this.d=i,this.ah(),f(this.bh.bind(this)),u(this.jb.bind(this))}get b(){return this.Dc.media}get a(){return this.d.delegate.a}jb(){this.Wg=!1,this.Xg=!1,this.Vg.Xa(),this.Da.empty()}$g(){const t=this.Dc.currentTime;this.d.$state.currentTime()!==t&&this.Tg(t)}ah(){this.Sg("loadstart",this.bb),this.Sg("abort",this.Zg),this.Sg("emptied",this.ch),this.Sg("error",this.Ja)}dh(){this.Wg||(this.Da.add(this.Sg("loadeddata",this.eh),this.Sg("loadedmetadata",this.fh),this.Sg("canplay",this.ee),this.Sg("canplaythrough",this.gh),this.Sg("durationchange",this.hh),this.Sg("play",this.Gb),this.Sg("progress",this.v),this.Sg("stalled",this.ih),this.Sg("suspend",this.jh)),this.Wg=!0)}kh(){this.Xg||(this.Da.add(this.Sg("pause",this.Hb),this.Sg("playing",this.lh),this.Sg("ratechange",this.mh),this.Sg("seeked",this.nh),this.Sg("seeking",this.oh),this.Sg("ended",this.ph),this.Sg("volumechange",this.qe),this.Sg("waiting",this.qh)),this.Xg=!0)}Sg(t,i){return a(this.b,t,i.bind(this))}sh(t){}Tg(t,i){const s={currentTime:Math.min(t,this.d.$state.seekableEnd()),played:this.b.played};this.a("time-update",s,i)}bb(t){if(this.b.networkState===3){this.Zg(t);return}this.dh(),this.a("load-start",void 0,t)}Zg(t){this.a("abort",void 0,t)}ch(){this.a("emptied",void 0,event)}eh(t){this.a("loaded-data",void 0,t)}fh(t){this.kh(),this.a("volume-change",{volume:this.b.volume,muted:this.b.muted},t),this.a("loaded-metadata",void 0,t),k&&y(this.d.$state.source())&&this.d.delegate.K(this.Yg(),t)}Yg(){return{provider:S(this.d.$provider),duration:this.b.duration,buffered:this.b.buffered,seekable:this.b.seekable}}Gb(t){this.d.$state.canPlay&&this.a("play",void 0,t)}Hb(t){this.b.readyState===1&&!this.Ug||(this.Ug=!1,this.Vg.Xa(),this.a("pause",void 0,t))}ee(t){this.d.delegate.K(this.Yg(),t)}gh(t){this.d.$state.started()||this.a("can-play-through",this.Yg(),t)}lh(t){this.Ug=!1,this.a("playing",void 0,t),this.Vg.Wa()}ih(t){this.a("stalled",void 0,t),this.b.readyState<3&&(this.Ug=!0,this.a("waiting",void 0,t))}qh(t){this.b.readyState<3&&(this.Ug=!0,this.a("waiting",void 0,t))}ph(t){this.Vg.Xa(),this.Tg(this.b.duration,t),this.a("end",void 0,t),this.d.$state.loop()?this.th():this.a("ended",void 0,t)}bh(){this.d.$state.paused()&&a(this.b,"timeupdate",this.uh.bind(this))}uh(t){this.Tg(this.b.currentTime,t)}hh(t){this.d.$state.ended()&&this.Tg(this.b.duration,t),this.a("duration-change",this.b.duration,t)}qe(t){const i={volume:this.b.volume,muted:this.b.muted};this.a("volume-change",i,t)}nh(t){this.Tg(this.b.currentTime,t),this.a("seeked",this.b.currentTime,t),Math.trunc(this.b.currentTime)===Math.trunc(this.b.duration)&&n(this.b.duration)>n(this.b.currentTime)&&(this.Tg(this.b.duration,t),this.b.ended||this.d.player.dispatch(new o("media-play-request",{trigger:t})))}oh(t){this.a("seeking",this.b.currentTime,t)}v(t){const i={buffered:this.b.buffered,seekable:this.b.seekable};this.a("progress",i,t)}th(){v(this.b.controls)&&(this.b.controls=!1),this.d.player.dispatch(new o("media-loop-request"))}jh(t){this.a("suspend",void 0,t)}mh(t){this.a("rate-change",this.b.playbackRate,t)}Ja(t){const i=this.b.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.a("error",s,t)}}class D{constructor(t,i){this.Dc=t,this.d=i,this.vh.onaddtrack=this.xh.bind(this),this.vh.onremovetrack=this.yh.bind(this),this.vh.onchange=this.zh.bind(this),a(this.d.audioTracks,"change",this.Ah.bind(this))}get vh(){return this.Dc.media.audioTracks}xh(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.d.audioTracks[h._](s,t),i.enabled&&(s.selected=!0)}yh(t){const i=this.d.audioTracks.getById(t.track.id);i&&this.d.audioTracks[h.Y](i,t)}zh(t){let i=this.wh();if(!i)return;const s=this.d.audioTracks.getById(i.id);s&&this.d.audioTracks[h.Va](s,!0,t)}wh(){return Array.from(this.vh).find(t=>t.enabled)}Ah(t){const{current:i}=t.detail;if(!i)return;const s=this.vh.getTrackById(i.id);if(s){const r=this.wh();r&&(r.enabled=!1),s.enabled=!0}}}class ${constructor(t){this.scope=c(),this.s=null,this.b=t}setup(t){new w(this,t),"audioTracks"in this.media&&new D(this,t),u(()=>{this.b.setAttribute("src",""),this.b.load()})}get type(){return""}get media(){return this.b}get currentSrc(){return this.s}get paused(){return this.b.paused}get muted(){return this.b.muted}set muted(t){this.b.muted=t}get volume(){return this.b.volume}set volume(t){this.b.volume=t}get currentTime(){return this.b.currentTime}set currentTime(t){this.b.currentTime=t}get playsinline(){return this.b.hasAttribute("playsinline")}set playsinline(t){b(this.b,"playsinline",t)}get playbackRate(){return this.b.playbackRate}set playbackRate(t){this.b.playbackRate=t}async play(){return this.b.play()}async pause(){return this.b.pause()}async loadSource({src:t,type:i},s){this.b.preload=s||"",g(t)?this.b.srcObject=t:(this.b.srcObject=null,this.b.src=m(t)?t:window.URL.createObjectURL(t)),this.b.load(),this.s={src:t,type:i}}}export{$ as H,T as R};
